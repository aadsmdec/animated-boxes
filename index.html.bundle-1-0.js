montageDefine("c989f18","ui/repetition.reel/repetition",{dependencies:["../../core/core","../component","../../core/template","../../core/range-controller","../../core/promise","../../core/browser","collections/map","collections/set","../../core/deprecate","../../core/logger","frb/observers"],factory:function(e,t){var n=e("../../core/core").Montage,i=e("../component").Component;e("../../core/template").Template;var r=e("../../core/range-controller").RangeController,a=e("../../core/promise").Promise,s=e("../../core/browser").browser,o=e("collections/map"),l=e("collections/set"),c=e("../../core/deprecate").deprecationWarning,u=e("../../core/logger").logger("repetition").color.magenta(),h=e("frb/observers"),d=h.observeProperty,p=h.observeKey,f=t.Iteration=n.specialize({repetition:{value:null},controller:{value:null},object:{value:null},selected:{value:null},_fragment:{value:null},_childComponents:{value:null},index:{value:null},_drawnIndex:{value:null},active:{value:null},_noTransition:{value:null},_templateDocumentPart:{value:null},isDirty:{value:!1},constructor:{value:function f(){this.super(),u.isDebug&&u.debug("Iteration:%s create iteration %O",Object.hash(this),this),this.repetition=null,this.controller=null,this.object=null,this.defineBinding("selected",{"<->":"object.defined() ? repetition.contentController.selection.has(object) : selected"}),this._fragment=null,this._childComponents=null,this.index=null,this._drawnIndex=null,this.active=!1,this.defineBinding("active",{"<->":"repetition.activeIterations.has(())"}),this._noTransition=!1,this.addOwnPropertyChangeListener("active",this),this.addOwnPropertyChangeListener("selected",this),this.addOwnPropertyChangeListener("_noTransition",this),this.addPathChangeListener("index.defined() && _childComponents.defined()",this,"handleComponentModelChange"),this.cachedFirstElement=null}},initWithRepetition:{value:function(e){return this.repetition=e,this}},recycle:{value:function(){this.index=null,this.object=null,this._noTransition=!0}},injectIntoDocument:{value:function(e){null!==this._drawnIndex?(u.isDebug&&u.debug("Iteration:%s retracting from index %s and injecting at %s",Object.hash(this),this._drawnIndex,e),this.retractFromDocument()):u.isDebug&&u.debug("Iteration:%s injecting at index %s",Object.hash(this),e);var t=this,n=this.repetition,i=n.element,r=n._boundaries,a=i.ownerDocument.createTextNode(""),s=r[e];if(r.splice(e,0,a),i.insertBefore(a,s),i.insertBefore(this._fragment,s),n._drawnIterations.splice(e,0,this),n._updateDrawnIndexes(e),n._addDirtyClassListIteration(this),!this._elementsWillBeAddedToMap){var o=this._childComponents.length,l=function(e){e.target.removeEventListener("firstDraw",l,!1),o--,o||t.forEachElement(function(e){n._iterationForElement.set(e,t)})};if(this._childComponents.length>0)for(var c=0;this._childComponents.length>c;c++){var h=this._childComponents[c];h.addEventListener("firstDraw",l,!1),h.needsDraw=!0,h._completedFirstDraw===!0&&console.error("Repetiton:%s child component %O has already drawn.",Object.hash(this),h)}else this.forEachElement(function(e){n._iterationForElement.set(e,t)});this._elementsWillBeAddedToMap=!0}}},_elementsWillBeAddedToMap:{value:!1},retractFromDocument:{value:function(){u.isDebug&&u.debug("Iteration:%s retractFromDocument drawnIndex: %s",Object.hash(this),this._drawnIndex);var e=this._drawnIndex,t=this.repetition,n=t.element,i=t._boundaries[e],r=t._boundaries[e+1];t._boundaries.splice(e,1);for(var a=this._fragment,s=i.nextSibling;s!=r;){var o=s.nextSibling;n.removeChild(s),a.appendChild(s),s=o}n.removeChild(i),this._drawnIndex=null,t._drawnIterations.splice(e,1),t._updateDrawnIndexes(e)}},handleComponentModelChange:{value:function(e){e?this._childComponents.forEach(this.repetition.addChildComponent,this.repetition):this._childComponents&&this._childComponents.forEach(this.repetition.removeChildComponent,this.repetition)}},handlePropertyChange:{value:function(){this.repetition&&(this.repetition._addDirtyClassListIteration(this),this.repetition.needsDraw=!0)}},forEachElement:{value:function(e,t){var n=this.repetition,i=this._drawnIndex;if(null!=i)for(var r=n._boundaries[i];r!==n._boundaries[i+1];r=r.nextSibling)1===r.nodeType&&e.call(t,r)}},firstElement:{get:function(){var e=this.repetition,t=this._drawnIndex;if(null!=t)for(var n=e._boundaries[t];n!==e._boundaries[t+1];n=n.nextSibling)if(1===n.nodeType)return this.cachedFirstElement=n,n}},isComponentTreeLoaded:{value:function(){return null!==this._fragment}},cachedFirstElement:{value:null}});t.Repetition=i.specialize({initWithContent:{value:function(e){return this.object=e,this}},initWithContentController:{value:function(e){return this.contentController=e,this}},content:{get:function(){return this.getPath("contentController.content")},set:function(e){this.contentController=(new r).initWithContent(e)}},contentController:{value:null},isSelectionEnabled:{value:null},selection:{value:null},selectedIterations:{value:null},selectedIndexes:{value:null},activeIterations:{value:null},iterations:{value:null},currentIteration:{value:null},objectAtCurrentIteration:{value:null},hasTemplate:{value:!1},_iterationTemplate:{value:null},clonesChildComponents:{value:!0},constructor:{value:function(){this.super(),this.contentController=null,this.organizedContent=[],this.defineBinding("organizedContent.rangeContent()",{"<-":"contentController.organizedContent"}),this.isSelectionEnabled=!1,this.defineBinding("selection",{"<->":"contentController.selection"}),this.defineBinding("selectedIterations",{"<-":"iterations.filter{selected}"}),this.defineBinding("selectedIndexes",{"<-":"selectedIterations.map{index}"}),this._iterationTemplate=null,this.addPathChangeListener(this._setupRequirements,this,"_handleSetupRequirementsChange"),this.addPathChangeListener("innerTemplate",this,"_handleInnerTemplateChange"),this.iterations=[],this._drawnIterations=[],this._freeIterations=[],this._contentForIteration=o(),this._iterationForElement=o(),this.currentIteration=null,this._templateId=null,this._iterationCreationPromise=a.resolve(),this._boundaries=[],this._dirtyClassListIterations=l(),this._requestedIterations=0,this._createdIterations=0,this._canDrawInitialContent=!1,this._initialContentDrawn=!1,this.addOwnPropertyChangeListener("isSelectionEnabled",this),this._selectionPointer=null,this.activeIterations=[]}},_setupRequirements:{value:"[!_iterationTemplate.defined(),!_newDomContent.defined(),!_shouldClearDomContentOnNextDraw,_isComponentExpanded,_ownerDocumentPart.defined()].every{}"},_handleSetupRequirementsChange:{value:function(e){e&&this._setupIterationTemplate()}},_handleInnerTemplateChange:{value:function(e){this._iterationTemplate&&this._teardownIterationTemplate(),e&&this.getPath(this._setupRequirements)&&this._setupIterationTemplate()}},cleanupDeletedComponentTree:{value:function(e){var t=this._innerTemplate;this._innerTemplate=null,t&&this._teardownIterationTemplate(),e&&this.cancelBindings()}},expandComponent:{value:function(){return this._isComponentExpanded=!0,a.resolve()}},_buildIterationTemplate:{value:function(){var e,t,i,r;return e=this.innerTemplate.clone(),t=e.getSerialization(),i=t.getSerializationObject(),r=n.getInfoForObject(this).label,this._iterationLabel=r+":iteration",i[this._iterationLabel]={},e.setObjects(i),this.innerTemplate.hasParameters()&&this._expandIterationTemplateParameters(e),window._montage_le_flag&&(e.refresher=this,this._leTagIterationTemplate(e)),e}},_rebuildIterationTemplate:{value:function(){var e,t=this._iterationTemplate,n=this.iterations;this._purgeFreeIterations();for(var i,r=0;i=n[r];r++)i.isDirty=!0;this._innerTemplate=null,e=this._buildIterationTemplate(),t.replaceContentsWithTemplate(e)}},refreshTemplate:{value:function(){this._rebuildIterationTemplate()}},_setupIterationTemplate:{value:function(){var e=this;this._iterationTemplate=this._buildIterationTemplate();for(var t,n=e.childComponents,i=n.length-1;t=n[i--];)t.detachFromParentComponent(),t.needsDraw=!1,t.cleanupDeletedComponentTree(!0);e.handleOrganizedContentRangeChange(e.organizedContent,[],0),e.organizedContent.addRangeChangeListener(e,"organizedContent"),e._canDrawInitialContent=!0,e.needsDraw=!0}},_leTagIterationTemplate:{value:function(e){var t=e.document.body;if(t.children.length>0){var n=this.ownerComponent._montage_metadata.moduleId,i=this._montage_metadata.label;this._leTagStarArgument(n,i,t)}}},_teardownIterationTemplate:{value:function(){this.organizedContent.removeRangeChangeListener(this,"organizedContent"),this.handleOrganizedContentRangeChange([],this.organizedContent,0),this._purgeFreeIterations(),this._iterationTemplate=null,this._contentForIteration.clear(),this._iterationForElement.clear(),this.currentIteration=null,this._templateId=null,this._requestedIterations=0,this._createdIterations=0,this._canDrawInitialContent=!1,this._selectionPointer=null,this.activeIterations.clear(),this._dirtyClassListIterations.clear()}},_purgeFreeIterations:{value:function(){for(var e=0;this._freeIterations.length>e;e++)for(var t=this._freeIterations[e],n=0;t._childComponents.length>n;n++){var i=t._childComponents[n];this.removeChildComponent(i),i.cleanupDeletedComponentTree(!0)}this._freeIterations.clear()}},_expandIterationTemplateParameters:{value:function(e){for(var t,n,i,r,a,s,o,l,c,u=this;e.hasParameters();){u=u.ownerComponent,t=u._ownerDocumentPart.template,r=u._ownerDocumentPart.objects,s=e.expandParameters(u),i=e.getSerialization().getExternalObjectLabels(),a=e.getInstances(),l=s.labels,n=s.labelsCollisions;for(var h,d=0;h=l[d];d++)o=n&&h in n?n[h]:h,i.indexOf(o)>=0?a[o]=r[h]:(c=t.getObjectMetadata(h),c.owner||(c.owner=r.owner),e.setObjectMetadata(o,c.require,c.label,c.owner))}}},_iterationLabel:{value:null},_iterationCreationPromise:{value:null},_createIteration:{value:function(){var e=this,t=(new this.Iteration).initWithRepetition(this);return this._iterationCreationPromise=this._iterationCreationPromise.then(function(){var n,i,r=e.element.ownerDocument;return e.currentIteration=t,n=e._iterationTemplate.getInstances(),n=Object.create(n),n[e._iterationLabel]=t,i=e._iterationTemplate.instantiateWithInstances(n,r).then(function(n){n.parentDocumentPart=e._ownerDocumentPart,t._templateDocumentPart=n,n.loadComponentTree().then(function(){u.isDebug&&u.debug("Iteration:%s component tree loaded.",Object.hash(t)),t._fragment=n.fragment,t._childComponents=n.childComponents,e.constructIteration(t)}).done(),e.currentIteration=null}),i.done(),i.then(null,function(){})}),this._requestedIterations++,t}},constructIteration:{value:function(){this._createdIterations++,this._createdIterations>=this._requestedIterations&&(this.needsDraw=!0,this._canDraw=!0)}},observeProperty:{value:function(e,t,n){return"contentAtCurrentIteration"===e||"objectAtCurrentIteration"===e?("contentAtCurrentIteration"===e?c("contentAtCurrentIteration",":iteration.object"):"objectAtCurrentIteration"===e&&c("objectAtCurrentIteration",":iteration.object"),p(this._contentForIteration,this.currentIteration,t,n)):"currentIteration"===e?(c("currentIteration",":iteration"),t(this.currentIteration)):d(this,e,t,n)}},makePropertyObservable:{value:function(e){return"currentIteration"!==e?n.makePropertyObservable.call(this,e):void 0}},_controllerIterations:{value:null},_drawnIterations:{value:null},_freeIterations:{value:null},_contentForIteration:{value:null},handleOrganizedContentRangeChange:{value:function(e,t,n){u.isDebug&&u.debug("Repetition:%s content changed +%s@%s %O -%s %O ",Object.hash(this),e?e.length:0,n,e,t?t.length:0,t);var i=this.iterations,r=this._contentForIteration;this._iterationTemplate.isDirty&&this._iterationTemplate.refresh();var a=Math.min(e.length,t.length),s=t.length-a,o=e.length-a;if(u.isDebug&&u.debug("Repetition:%s +%s -%s iterations",Object.hash(this),o,s),a>0)for(var l=0;a>l;l++,n++)i[n].object=e[l],r.set(i[n],e[l]);if(s>0){var c=i.splice(n,s);c.forEach(function(e){e.recycle()});for(var h,l=0;h=c[l];l++)h.isDirty||this._freeIterations.push(h)}if(o>0){if(u.isDebug)var d=[];for(;o>this._freeIterations.length;)this._freeIterations.push(this._createIteration()),u.isDebug&&d.push(this._freeIterations[this._freeIterations.length-1]);for(var p=Array(o),l=a,f=0;e.length>l;l++,f++){var m=this._freeIterations.pop();u.isDebug&&(d.has(m)||u.debug("Repetition:%s reusing %s",Object.hash(this),Object.hash(m)));var g=e[l];m.object=g,r.set(m,g),p[f]=m}i.swap(n,0,p)}(s>0||o>0)&&this._updateIndexes(n),this.needsDraw=!0}},_updateIndexes:{value:function(e){for(var t=this.iterations;t.length>e;e++)t[e].index=e}},_addDirtyClassListIteration:{value:function(e){e.forEachElement(function(t){var n;t&&(n=t.component)?(n.classList[e.active?"add":"remove"]("active"),n.classList[e.selected?"add":"remove"]("selected"),n.classList.remove("no-transition")):this._dirtyClassListIterations.add(e)},this)}},canDraw:{value:function(){var e=this.canDrawGate.value;return e=e&&this._requestedIterations<=this._createdIterations,e=e&&(this._initialContentDrawn||this._canDrawInitialContent)}},_boundaries:{value:null},_dirtyClassListIterations:{value:null},_requestedIterations:{value:null},_createdIterations:{value:null},_canDrawInitialContent:{value:null},_initialContentDrawn:{value:null},draw:{value:function(){this._initialContentDrawn||(this._drawInitialContent(),this._initialContentDrawn=!0);for(var e=this._drawnIterations.length-1;e>=0;e--)null===this._drawnIterations[e].index&&this._drawnIterations[e].retractFromDocument();for(var e=0;this.iterations.length>e;e++){var t=this.iterations[e];t._drawnIndex!==t.index&&t.isComponentTreeLoaded()&&t.injectIntoDocument(e)}var n=this._dirtyClassListIterations.toArray();this._dirtyClassListIterations.clear(),n.forEach(function(e){e.isComponentTreeLoaded()&&e.forEachElement(function(t){t.component||(t.classList[e.active?"add":"remove"]("active"),t.classList[e.selected?"add":"remove"]("selected"),t.classList.remove("no-transition"))},this)},this)}},_drawInitialContent:{value:function(){for(var e=this.element,t=e.childNodes.length,n=0;t>n;n++)e.removeChild(e.firstChild);var i=e.ownerDocument.createTextNode("");e.appendChild(i),this._boundaries.push(i)}},_updateDrawnIndexes:{value:function(e){for(var t=this._drawnIterations;t.length>e;e++)t[e]._drawnIndex=e}},_selectionPointer:{value:null},handleIsSelectionEnabledChange:{value:function(e){e?this._enableSelectionTracking():this._disableSelectionTracking()}},_enableSelectionTracking:{value:function(){s.android&&s.android.androidBrowser?window.Touch?this.element.addEventListener("touchstart",this,!0):this.element.addEventListener("mousedown",this,!0):(this.element.addEventListener("touchstart",this,!0),this.element.addEventListener("mousedown",this,!0))}},_disableSelectionTracking:{value:function(){s.android&&s.android.androidBrowser?window.Touch?this.element.removeEventListener("touchstart",this,!0):this.element.removeEventListener("mousedown",this,!0):(this.element.removeEventListener("touchstart",this,!0),this.element.removeEventListener("mousedown",this,!0))}},_observeSelectionPointer:{value:function(e){this._selectionPointer=e,this.eventManager.claimPointer(e,this);var t=this.element.ownerDocument;t.addEventListener("touchend",this,!1),t.addEventListener("touchcancel",this,!1),t.addEventListener("mouseup",this,!1)}},_ignoreSelectionPointer:{value:function(){this.eventManager.isPointerClaimedByComponent(this._selectionPointer,this)&&this.eventManager.forfeitPointer(this._selectionPointer,this),this._selectionPointer=null,this.activeIterations.clear();var e=this.element.ownerDocument;e.removeEventListener("touchend",this,!1),e.removeEventListener("touchcancel",this,!1),e.removeEventListener("mouseup",this,!1)}},captureMousedown:{value:function(e){if(null==this._selectionPointer){this._observeSelectionPointer("mouse");var t=this._findIterationContainingElement(e.target);t?t.active=!0:this._ignoreSelectionPointer()}}},captureTouchstart:{value:function(e){if(null==this._selectionPointer){this._observeSelectionPointer(e.changedTouches[0].identifier);var t=this._findIterationContainingElement(e.target);t?t.active=!0:this._ignoreSelectionPointer()}}},handleTouchend:{value:function(e){for(var t=0;e.changedTouches.length>t&&!this._endSelectionOnTarget(e.changedTouches[t].identifier,e.target);t++);}},handleTouchcancel:{value:function(){this._ignoreSelectionPointer()}},handleMouseup:{value:function(e){this._endSelectionOnTarget("mouse",e.target)}},_endSelectionOnTarget:{value:function(e,t){if(e===this._selectionPointer){if(this.eventManager.isPointerClaimedByComponent(this._selectionPointer,this)){var n=this._findIterationContainingElement(t);n&&(n.active=!1,n.selected||(n.selected=!0))}return this._ignoreSelectionPointer(),!0}}},_findIterationContainingElement:{value:function(e){for(var t;e;){if(e===this.element)return this._iterationForElement.get(t);t=e,e=e.parentNode}}},Iteration:{value:f,serializable:!1}})}}),montageDefine("c989f18","core/range-controller",{dependencies:["./core","collections/generic-collection"],factory:function(e,t){var n=e("./core").Montage,i=e("collections/generic-collection"),r=function(e,t){var n=e.clone();n.makeObservable(),n.rangeController=t,n.contentEquals=e&&e.contentEquals||Object.is,Object.defineProperty(n,"clone",{value:function(){return n.slice()}});var i=n.splice;return Object.defineProperty(n,"splice",{configurable:!1,value:function(e,t){var n=this.rangeController.content;this.contentEquals=n&&n.contentEquals||Object.is,e=e>=0?e:this.length+e;var r=this.length,a=Math.min(t,r-e),s=[].slice.call(arguments,2);s.contentEquals=this.contentEquals;var o,l=s.filter(function(t,i){if(n&&!n.has(t))return!1;if(s.findLast(t)>i)return!1;var r=this.find(t);return 0>r||r>=e&&e+a>r},this),c=Math.max(l.length,0),u=c-a,h=Math.max(r+u,e+c);if(!this.rangeController.multiSelect&&h>1){var d=c?l[c-1]:this.one();o=[0,r,d]}else o=this.rangeController.avoidsEmptySelection&&0===h?n.has(this[0])?[1,this.length-1]:[0,this.length,n.one()]:[e,t].concat(l);return i.apply(this,o)}}),n};t.RangeController=n.specialize({constructor:{value:function(e){this.content=null,this._selection=new r([],this),this.sortPath=null,this.filterPath=null,this.visibleIndexes=null,this.reversed=!1,this.start=null,this.length=null,this.selectAddedContent=!1,this.deselectInvisibleContent=!1,this.clearSelectionOnOrderChange=!1,this.avoidsEmptySelection=!1,this.multiSelect=!1,this.organizedContent=[],this.organizedContent.addRangeChangeListener(this,"organizedContent"),this.defineBinding("_orderedContent",{"<-":"content.($filterPath.defined() ? filter{path($filterPath)} : ()).($sortPath.defined() ? sorted{path($sortPath)} : ()).($reversed ?? 0 ? reversed() : ())"}),this.defineBinding("organizedContent.rangeContent()",{"<-":"_orderedContent.($visibleIndexes.defined() ?$visibleIndexes.filter{<$_orderedContent.length}.map{$_orderedContent[()]} : ()).($start.defined() && $length.defined() ?view($start, $length) : ())"}),this.addRangeAtPathChangeListener("content",this,"handleContentRangeChange"),this.addPathChangeListener("sortPath",this,"handleOrderChange"),this.addPathChangeListener("reversed",this,"handleOrderChange"),this.addOwnPropertyChangeListener("multiSelect",this),this.iterations=[],e&&this.initWithContent(e)}},initWithContent:{value:function(e){return this.content=e,this}},sortPath:{value:null},reversed:{value:null},filterPath:{value:null},visibleIndexes:{value:null},start:{value:null},length:{value:null},selectAddedContent:{value:!1},deselectInvisibleContent:{value:!1},clearSelectionOnOrderChange:{value:!1},avoidsEmptySelection:{value:!1},multiSelect:{value:!1},_orderedContent:{value:null},organizedContent:{value:null},iterations:{value:null},_selection:{value:null},selection:{get:function(){return this._selection},set:function(e){var t=[0,this._selection.length];e&&e.toArray&&(t=t.concat(e.toArray())),this._selection.splice.apply(this._selection,t)}},select:{value:function(e){!this.multiSelect&&this.selection.length>=1&&this.selection.clear(),this.selection.add(e)}},deselect:{value:function(e){(!this.avoidsEmptySelection||this.selection.length>1)&&this.selection["delete"](e)}},clearSelection:{value:function(){(!this.avoidsEmptySelection||this.selection.length>1)&&this.selection.clear()}},add:{value:function(e){var t;return this.content||(this.content=[]),t=this.content.add(e),t&&this.handleAdd(e),t}},push:{value:function(){for(var e=this.content.push.apply(this.content,arguments),t=0;arguments.length>t;t++)this.handleAdd(arguments[t]);return e}},pop:{value:function(){return this.content.pop()}},shift:{value:function(){return this.content.shift()}},unshift:{value:function(){for(var e=this.content.unshift.apply(this.content,arguments),t=0;arguments.length>t;t++)this.handleAdd(arguments[t]);return e}},splice:{value:function(){for(var e=this.content.splice.apply(this.content,arguments),t=2;arguments.length>t;t++)this.handleAdd(arguments[t]);return e}},swap:{value:function(e,t,n){var i=this.content.swap.apply(this.content,arguments);if(n)for(var e=2;n.length>e;e++)this.handleAdd(n[e]);return i}},"delete":{value:function(e){return this.content["delete"](e)}},has:{value:function(e){return this.content?this.content.has(e):!1}},addEach:{value:i.prototype.addEach},deleteEach:{value:i.prototype.deleteEach},clear:{value:function(){this.content.clear()}},addContent:{value:function(){var e=new this.contentConstructor;return this.add(e),e}},_contentConstructor:{value:null},contentConstructor:{get:function(){return this._contentConstructor?this._contentConstructor:this.content&&this.content.contentConstructor?this.content.contentConstructor:Object},set:function(e){this._contentConstructor=e}},handleContentRangeChange:{value:function(e,t){if(this.selection.length>0){var n=this.content&&this.content.contentEquals||Object.is;t.deleteEach(e,n),this.selection&&this.selection.deleteEach(t)}}},handleSelectionRangeChange:{value:function(e,t){if(this.selection)if(this.content){for(var n=[],i=0;e.length>i;i++)this.content.has(e[i])||n.push(e[i]);if(this._selection.deleteEach(n),!this.multiSelect&&this._selection.length>1){var r=this._selection.pop();this._selection.clear(),this._selection.add(r)}this.avoidsEmptySelection&&0==this._selection.length&&this._selection.add(t[0])}else this._selection.clear()}},handleOrganizedContentRangeChange:{value:function(e,t){if(this.deselectInvisibleContent&&this.selection){var n=t.clone(1);n.deleteEach(e),this.selection.deleteEach(t)}}},handleOrderChange:{value:function(){this.clearSelectionOnOrderChange&&this.selection&&this.selection.clear()}},handleAdd:{value:function(e){this.selectAddedContent&&this.selection&&(!this.multiSelect&&this.selection.length>=1&&this.selection.clear(),this.selection.add(e))}},handleMultiSelectChange:{value:function(){if(this.selection){var e=this.selection.length;if(!this.multiSelect&&e>1){var t=this._selection.pop();this._selection.clear(),this._selection.add(t)}}}}},{blueprintModuleId:e("./core")._blueprintModuleIdDescriptor,blueprint:e("./core")._blueprintDescriptor})}}),montageDefine("6771cdc","ui/main.reel/main.html",{text:'<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n    <title>Main</title>\n\n    <link rel=stylesheet href=main.css>\n\n    <script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"main"},"total":300}},"grid":{"prototype":"montage/ui/repetition.reel","properties":{"element":{"#":"grid"}},"bindings":{"content":{"<-":"@owner.array"},"objects":{"<-":"@owner.array"}}},"box":{"prototype":"ui/box.reel","properties":{"element":{"#":"box"}},"bindings":{"top":{"<-":"@owner.top"},"left":{"<-":"@owner.left"},"color":{"<-":"@owner.color"},"content":{"<-":"@owner.content"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=main data-montage-skin=light class=Main>\n        <div data-montage-id=grid id=grid>\n            <div class=box-view>\n                <div data-montage-id=box></div>\n            </div>\n        </div>\n    </div>\n\n\n</body></html>'}),montageDefine("6771cdc","ui/box.reel/box",{dependencies:["montage/ui/component"],factory:function(e,t){var n=e("montage/ui/component").Component;t.Box=n.specialize({constructor:{value:function(){this.super()}},_top:{value:null},top:{set:function(e){this._top=e,this.needsDraw=!0},get:function(){return this._top}},_left:{value:null},left:{set:function(e){this._left=e,this.needsDraw=!0},get:function(){return this._left}},_color:{value:null},color:{set:function(e){this._color=e,this.needsDraw=!0},get:function(){return this._color}},_content:{value:null},content:{set:function(e){this._content=e,this.needsDraw=!0},get:function(){return this._content}},_count:{value:null},count:{set:function(e){this._count=e,this.needsDraw=!0},get:function(){return this._count}},draw:{value:function(){var e=this._element,t=e.style;e.textContent=this._content,t.top=this._top+"px",t.left=this._left+"px",t.background="rgb(0, 0, "+this._color+")"}}})}}),montageDefine("c989f18","core/browser",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage,i=RegExp(/AppleWebKit\/([\d.]+)/),r=n.specialize({constructor:{value:function r(e){this.super(),this._userAgent=e,this._analyze(e)}},_analyze:{value:function(e){if(e.indexOf("Android")>-1&&e.indexOf("Mozilla/5.0")>-1&&e.indexOf("AppleWebKit")>-1){this.android={};var t=i.exec(e),n=null===t?null:parseFloat(i.exec(e)[1]);this.android.androidBrowser=null!==n&&537>n}}},_userAgent:{value:null}}),a=null;n.defineProperties(t,{browser:{get:function(){return null===a&&(a=new r(navigator.userAgent)),a}},Browser:{value:r}})}}),montageDefine("6771cdc","ui/main.reel/main",{dependencies:["montage/ui/component"],factory:function(e,t){var n=e("montage/ui/component").Component;t.Main=n.specialize({constructor:{value:function(){this.super()}},count:{value:0},array:{value:null},templateDidLoad:{value:function(){for(var e=[],t=0;this.total>t;t++)e[t]=t;this.array=e,this.needsDraw=!0}},draw:{value:function(){var e=this.count++;this.top=10*Math.sin(e/10),this.left=10*Math.cos(e/10),this.color=e%255,this.content=e%100,this.needsDraw=!0}}})}}),montageDefine("6771cdc","ui/box.reel/box.html",{text:'<!DOCTYPE html><html><head>\n    <title></title>\n    <link rel=stylesheet type=text/css href=box.css>\n    <script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"owner"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=owner class=Box>\n    </div>\n\n\n</body></html>'});
bundleLoaded("index.html.bundle-1-0.js")